{"version":3,"sources":["../../../public/js/chat.js"],"names":["socket","io","scrollToBottom","messages","$","newMessage","children","clientHeight","prop","scrollTop","scrollHeight","newMessageHeight","innerHeight","lastMessageHeight","prev","on","userData","deparam","window","location","search","emit","err","alert","href","console","log","users","ol","forEach","user","append","text","html","message","formattedTime","moment","createdAt","format","template","Mustache","render","from","url","e","preventDefault","messageTextbox","val","locationButton","navigator","geolocation","attr","getCurrentPosition","position","removeAttr","latitude","coords","longitude"],"mappings":"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","file":"chat.js","sourcesContent":["const socket = io();\n\nfunction scrollToBottom () {\n    // Selectors\n    let messages = $(\"#messages\");\n    let newMessage = messages.children(\"li:last-child\");\n    // Heights\n    let clientHeight = messages.prop(\"clientHeight\");\n    let scrollTop = messages.prop(\"scrollTop\");\n    let scrollHeight = messages.prop(\"scrollHeight\");\n    let newMessageHeight = newMessage.innerHeight();\n    let lastMessageHeight = newMessage.prev().innerHeight();\n\n    if (clientHeight + scrollTop + newMessageHeight + lastMessageHeight >= scrollHeight) {\n        messages.scrollTop(scrollHeight);\n    }\n}\n\nsocket.on(\"connect\", function () {\n    let userData = $.deparam(window.location.search); //deparam library\n\n    socket.emit(\"join\", userData, (err) => {\n        if (err) {\n            alert(err);\n            window.location.href = \"/\";\n        } else {\n            console.log(\"no error\")\n        }\n    })\n});\n\nsocket.on(\"disconnect\", function () {\n    console.log(\"Disconnected from server\");\n});\n\nsocket.on(\"updateUserList\", (users) => {\n    let ol = $(\"<ol></ol>\");\n\n    users.forEach(function(user){\n        ol.append($(\"<li></li>\").text(user))\n    });\n\n    $(\"#users\").html(ol);\n});\n\nsocket.on(\"newMessage\", function (message) {\n    let formattedTime = moment(message.createdAt).format(\"H:mm\");\n    let template = $(\"#message-template\").html();\n    let html = Mustache.render(template, {\n        text: message.text,\n        from: message.from,\n        createdAt: formattedTime\n    });\n\n    $(\"#messages\").append(html);\n    scrollToBottom();\n});\n\nsocket.on(\"newLocationMessage\", function (message) {\n    let formattedTime = moment(message.createdAt).format(\"H:mm\");\n    let template = $(\"#location-message-template\").html();\n    let html = Mustache.render(template, {\n        from: message.from,\n        url: message.url,\n        createdAt: formattedTime\n    });\n\n    $(\"#messages\").append(html);\n    scrollToBottom();\n});\n\n$(\"#message-form\").on(\"submit\", function (e) {\n    e.preventDefault();\n\n    let messageTextbox = $(\"[name=message]\");\n\n    socket.emit(\"createMessage\", {\n        text: messageTextbox.val()\n    }, function () {\n        messageTextbox.val(\"\")\n    });\n});\n\nlet locationButton = $(\"#send-location\");\nlocationButton.on(\"click\", function () {\n    if (!navigator.geolocation) {\n        return alert(\"Geolocation nicht unterstuetzt.\");\n    }\n\n    locationButton.attr(\"disabled\", \"disabled\").text(\"Ermittle Position...\");\n\n    navigator.geolocation.getCurrentPosition(function (position) {\n        locationButton.removeAttr(\"disabled\").text(\"Sende GPS\");\n        socket.emit(\"createLocationMessage\", {\n            latitude: position.coords.latitude,\n            longitude: position.coords.longitude\n        });\n    }, function () {\n        locationButton.removeAttr(\"disabled\").text(\"Sende GPS\");\n        alert(\"Keine Verbindung zum GPS.\");\n    });\n});"]}