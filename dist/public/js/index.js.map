{"version":3,"sources":["../../../public/js/index.js"],"names":["socket","io","scrollToBottom","messages","$","newMessage","children","clientHeight","prop","scrollTop","scrollHeight","newMessageHeight","innerHeight","lastMessageHeight","prev","on","console","log","message","formattedTime","moment","createdAt","format","template","html","Mustache","render","text","from","append","url","e","preventDefault","messageTextbox","emit","val","locationButton","navigator","geolocation","alert","attr","getCurrentPosition","position","removeAttr","latitude","coords","longitude"],"mappings":"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","file":"index.js","sourcesContent":["const socket = io();\n\nfunction scrollToBottom () {\n    // Selectors\n    let messages = $(\"#messages\");\n    let newMessage = messages.children(\"li:last-child\");\n    // Heights\n    let clientHeight = messages.prop(\"clientHeight\");\n    let scrollTop = messages.prop(\"scrollTop\");\n    let scrollHeight = messages.prop(\"scrollHeight\");\n    let newMessageHeight = newMessage.innerHeight();\n    let lastMessageHeight = newMessage.prev().innerHeight();\n\n    if (clientHeight + scrollTop + newMessageHeight + lastMessageHeight >= scrollHeight) {\n        messages.scrollTop(scrollHeight);\n    }\n}\n\nsocket.on(\"connect\", function () {\n    console.log(\"Connected to server\");\n});\n\nsocket.on(\"disconnect\", function () {\n    console.log(\"Disconnected from server\");\n});\n\nsocket.on(\"newMessage\", function (message) {\n    let formattedTime = moment(message.createdAt).format(\"H:mm\");\n    let template = $(\"#message-template\").html();\n    let html = Mustache.render(template, {\n        text: message.text,\n        from: message.from,\n        createdAt: formattedTime\n    });\n\n    $(\"#messages\").append(html);\n    scrollToBottom();\n});\n\nsocket.on(\"newLocationMessage\", function (message) {\n    let formattedTime = moment(message.createdAt).format(\"H:mm\");\n    let template = $(\"#location-message-template\").html();\n    let html = Mustache.render(template, {\n        from: message.from,\n        url: message.url,\n        createdAt: formattedTime\n    });\n\n    $(\"#messages\").append(html);\n    scrollToBottom();\n});\n\n$(\"#message-form\").on(\"submit\", function (e) {\n    e.preventDefault();\n\n    let messageTextbox = $(\"[name=message]\");\n\n    socket.emit(\"createMessage\", {\n        from: \"User\",\n        text: messageTextbox.val()\n    }, function () {\n        messageTextbox.val(\"\")\n    });\n});\n\nlet locationButton = $(\"#send-location\");\nlocationButton.on(\"click\", function () {\n    if (!navigator.geolocation) {\n        return alert(\"Geolocation nicht unterstuetzt.\");\n    }\n\n    locationButton.attr(\"disabled\", \"disabled\").text(\"Ermittle Position...\");\n\n    navigator.geolocation.getCurrentPosition(function (position) {\n        locationButton.removeAttr(\"disabled\").text(\"Sende GPS\");\n        socket.emit(\"createLocationMessage\", {\n            latitude: position.coords.latitude,\n            longitude: position.coords.longitude\n        });\n    }, function () {\n        locationButton.removeAttr(\"disabled\").text(\"Sende GPS\");\n        alert(\"Keine Verbindung zum GPS.\");\n    });\n});"]}